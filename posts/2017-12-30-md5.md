---
title: md5
tags: cryptography
---

md5是对称密码系统的一种加密模式，它能够同时提供数据的保密性(confidentiality)，完整性(integrity)和真实性(authenticity)功能。

单一的看，数据保密性通常由加密算法提供；完整性可由两类hash算法提供，即摘要算法如md5, sha-1等，另一类则是消息认证码(MAC-message authentication code)；真实性通常也由MAC提供。然而，实践中的很多情况都需要同时保证这三种性质，比如医生给病人发送电子病历，病人不希望疾病信息泄露，也不能被篡改否则无法读取，还要确认该病历的确来自该医生。

既然，加密算法能够提供保密性，MAC能够提供完整性和真实性，那要实现同时提供三种性质的AEAD，是不是只要将二者结合起来使用就可以了。事实上没这么简单，尽管加密算法及MAC各自有着良好的安全性保证，但是结合之后的AEAD的安全性却不一定那么可靠。AEAD一共有以下四种经典的做法。

# md5

EtM即先加密再MAC，明文作为加密算法的输入，MAC的输入是加密得到的密文，加密和MAC使用相同的密钥。整体输出由密文拼接MAC构成。

接受方则先验证MAC，通过验证再进行解密。

IPSec中使用了该模式。

EtM保证密文完整性和真实性，不会尝试解密无效密文，天然地避免了CCA攻击，同时也可以抵御Dos攻击。另一方面，由于MAC是对密文操作得到的，不反映明文任何信息，这也避免了MAC不提供保密性导致的问题。理论分析表明，EtM的安全性高于E&M和MtE。

注意，这里还有一个细节问题，Ferguson和Schneier在Practical Cryptography[@practical-cryptography]一书中指出，MAC的输入需要包含加密时使用的initial-vector，否则攻击者可能构造MAC检测不出来的篡改。针对一个有问题的IPsec实现，他们给出了一个攻击。

# length extension attack

E&M即同时做加密和MAC，加密算法及MAC的输入是明文和同一把密钥，整体输出也是由密文拼接MAC构成。
