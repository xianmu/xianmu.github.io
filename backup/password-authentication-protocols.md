---
title: password authentication protocols
tags: security
---

基于密码的认证方式十分常见，本文主要介绍密码认证的几种主要协议。为表述方便，假定Client请求Server的服务，Server认证Client以确定其身份。

# Threat models

针对认证的攻击目的是冒充Client骗过Server，从而获取合法用户的数据，或者获得合法用户的权限执行危险任务。基于密码的认证方式主要面临以下三种威胁：

1. 攻击Server一侧存储的密码信息，如读取密码文件(/etc/passwd)，或者通过拖库获取存储在数据库中的密码信息。

2. 攻击信道，监听窃取client和server间的通信内容，猜解用户密码或者实施重放攻击(Replay attack)。

3. 直接攻击用户获取密码，如通过钓鱼等方式诱导用户输入密码。

其中，第三类攻击从技术层面很难彻底解决。密码认证协议主要考虑解决前两种安全问题。

# Basic method

为抵御存储攻击，密码显然不能以明文存储，可以使用单向函数映射后存储，图示如下：

图图图图图图图图图图图图图图图图图图

由于单向函数的性质，攻击者不能反推得到明文密码。注意，hash是在server端做的，如果在client做，在信道上传输hash后端值，有什么问题？攻破密码数据库后可以进行重放攻击。

单向函数的选择也很重要，直接用SHA-1或者MD5会面临彩虹攻击或者直接匹配泄露密码库，所以应当使用加盐的版本。另一方面，SHA-1及MD5已被攻破，不应再继续使用了，应该用SHA-256替代。

为抵御信道监听，密码不能以明文形式传输，同样的可以传输单向函数映射后的值。考虑到前面抵御存储攻击时要在Server端做一次映射，这里可以再套一层，如下图：

图图图图图图图图图图图图图图图图图图

抵御信道攻击还能想到一个常用的办法，即信道加密，但是安全信道的建立需要很多其他配套设施，这里先略过。

# SCRAM

不难看出，SCRAM一样不能抵御存储及通信的复合攻击，即在攻击者同时获得存储的密码信息及通信内容时，还是能够成功骗过server端的认证。

# Lamport'81

Leslie Lamport于1981年提出了一个非常巧妙的办法，可以同时抵御这两种攻击。

# Secure channel

Lamport'81固然能解决密码认证的问题，但是认证不是独立存在的步骤，通常认证过程是后续交互过程的一个安全前提，只有这个安全前提不足以保证整个会话过程安全。
